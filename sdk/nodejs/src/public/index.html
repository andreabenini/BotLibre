<!--
*  Copyright 2023 Paphus Solutions Inc.
*
*  Licensed under the Eclipse Public License, Version 1.0 (the "License");
*  you may not use this file except in compliance with the License.
*  You may obtain a copy of the License at
*
*      http://www.eclipse.org/legal/epl-v10.html
*
*  Unless required by applicable law or agreed to in writing, software
*  distributed under the License is distributed on an "AS IS" BASIS,
*  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
*  See the License for the specific language governing permissions and
*  limitations under the License.
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Libre Nodejs SDK</title>
    <link rel="stylesheet" type="text/css" href="./styles/main.css">
</head>

<body>
    <h1>Bot Libre Nodejs SDK</h1>
    <div style="display: block; text-align: left;">
        <li>The Bot Libre Nodjs SDK allows you to easily integrate Bot Libre with a nodjs application.
            Through the SDK you can connect to your bots on Bot Libre, send messages, and train and configure your bots.
            You can also access Bot Libre analytics and AI services, and other content. Start by setting the
            'Application ID', 'username' and 'password' are required. If you don't have an account yet, you can create
            one at <a href="https://botlibre.com/login?sign-up=true">botlibre</a>. You can get an application ID from
            any of the services websites (Bot Libre, Bot Libre for Business). </li>
        <li>Once you have obtained your Credentials, you can start by testing the
            API's<code>/connect</code> and <code>/chat</code> respectively, by selecting them from the dropdown menu
            above. <code>/connect</code> is used to log the user in and establish a new token, which will be saved as a
            cookie in the browser. <strong>Note:</strong> Once the user has logged in, there's no need to use the
            <code>/connect</code> endpoint again every time. Instead, you can proceed with other operations, such as
            using the <code>/chat</code> endpoint.
        </li>
        <li>There are other API calls that require additional information, which needs to be entered
            manually. Please review the file <code>index.html</code> for further details.</li>
    </div>
    <div>
        <label id="apiLabel" for="apiSelector">Select API: </label>
        <select id="apiSelector">
            <option value="connect">connect</option>
            <option value="chat">chat</option>
            <option value="view-user">view-user</option>
            <!--TODO: Add more apis -->
        </select>
        <button onclick="executeAPI()">Test</button>
    </div>
    <div>
        <table>
            <tr>
                <th colspan="2">Login Credentials</th>
            </tr>
            <tr>
                <td><label for="username">Username:</label></td>
                <td><input type="text" id="username" name="username" required></td>
            </tr>
            <tr>
                <td><label for="password">Password:</label></td>
                <td><input type="password" id="password" name="password" required></td>
            </tr>
            <tr>
                <td><label for="id">Application Id:</label></td>
                <td><input type="text" id="id" name="id" required></td>
            </tr>
            <tr>
            </tr>
        </table>
    </div>
    <div id="result">

    </div>
    <script>
        //HELPER FUNCTIONS
        function appendResult(data) {
            let tag = document.getElementById("result")
            tag.innerHTML = tag.innerHTML + data + "<br>"
        }
        function printProperties(any) {
            document.getElementById("result").innerHTML = ""
            for (const key in any) {
                if (Object.hasOwnProperty.call(any, key)) {
                    appendResult(key + ": " + any[key])
                }
            }
        }
        function requestInit(method, body) { //Fetch helper function
            return {
                method: method,
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            }
        }
        async function sdkFetch(url, reqInit) {
            let data
            await fetch(url, reqInit).then(async (res) => {
                if (res.ok) appendResult("SUCCESS")
                else appendResult("FAILED")
                data = await res.json()
                printProperties(data)
            }).catch(error => appendResult("ERROR: " + error))
            return data
        }



        //API CALLS
        async function executeAPI() {
            let selectedApi = document.getElementById("apiSelector").value;
            switch (selectedApi) {
                case "connect":
                    let data = await sdkFetch("/connect", requestInit("POST", {
                        username: document.getElementById("username").value,
                        applicationId: document.getElementById("id").value,
                        password: document.getElementById("password").value
                    }))
                    break
                case "chat":
                    await sdkFetch("/chat", requestInit("POST", { message: "Hello World!", botId: "165" }))
                    break
                case "view-user":
                    await sdkFetch("/view-user", requestInit("POST", { username: "" }))
                    break
                default:
                    console.log("Invalid API selection")
            }
        }
    </script>

</body>

</html>